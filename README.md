# Домашнее задание к занятию "`Компоненты Kubernetes`" - `Дедюрин Денис`

---
## Задание. Необходимо определить требуемые ресурсы.

Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения.
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

### Ответ:

1. Определим требования к кластеру:

* Проект состоит из следующих компонентов:
* База данных (отказоустойчивая, 3 копии)
* Система кеширования (отказоустойчивая, 3 копии)
* Бекенд-приложение (10 копий)
* Фронтенд-приложение (5 копий)

2. Расчитаем необходимые ресурсы:

| Компонент    | Количество копий | RAM на копию | CPU на копию | Всего RAM | Всего CPU |
|--------------|------------------|--------------|--------------|-----------|-----------|
| База данных  | 3                | 4 ГБ          | 1 ядро        | 12 ГБ      | 3 ядра     |
| Кеш          | 3                | 4 ГБ          | 1 ядро        | 12 ГБ      | 3 ядра     |
| Фронтенд     | 5                | 50 МБ         | 0.2 ядра      | 250 МБ     | 1 ядро     |
| Бекенд       | 10               | 600 МБ        | 1 ядро        | 6 ГБ       | 10 ядер    |
| **Итого**    | —                | —             | —             | **30.25 ГБ** | **17 ядер** |

3. Учитываем служебные ресурсы:

На системные поды Kubernetes резервируем дополнительно 15% ресурсов.

Итого с учетом запаса:

Память:

```
30.25×1.15=34.79 ГБ
```

CPU:

```
17×1.15=19.55 ядер
```

4. Для обеспечения отказоустойчивости (выход из строя одной ноды) необходимо планировать загрузку нод не выше 70%.
   
   Подбираем рабочие ноды:
Например, возьмем рабочую ноду со следующими параметрами: 

```
RAM: 16 ГБ
CPU: 8 vCPU
```

Вычисляем:

По памяти:

```
34.79/(16×0.7) ≈ 3.11 (округляем до 4 нод)
​```

По CPU:

```
19.55/(8×0.7) ≈ 3.49 (округляем до 4 нод)
```

**ИТОГО:**

| Параметр                | Значение |
|--------------------------|----------|
| Количество рабочих нод   | 4        |
| Память на ноду           | 16 ГБ    |
| CPU на ноду              | 8 vCPU   |


5. Вывод:

* Количество нод: 4

* Размер каждой ноды: 16 ГБ RAM, 8 vCPU

* Общая обеспечиваемая нагрузка: ~35 ГБ памяти и ~20 ядер CPU с учетом запаса на системные поды и отказ одной ноды.